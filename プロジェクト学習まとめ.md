# ğŸ“ Pythonãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’ã¾ã¨ã‚ï¼ˆæœ€æ–°ç‰ˆï¼‰

## ğŸ”¥ ã‚¯ãƒ©ã‚¹ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®å®Œå…¨ç†è§£
### ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã®æœ¬è³ª
```python
uploader = GCSUploader("bucket-name")  # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
downloader = PowerDataDownloader()     # åŒã˜ä»•çµ„ã¿
df = pd.DataFrame(data)                # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚åŒæ§˜
```

**é‡è¦ãªæ°—ã¥ã**: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚è‡ªä½œã‚¯ãƒ©ã‚¹ã‚‚åŒã˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–  
**è¨­è¨ˆæ€æƒ³**: 1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¤‡æ•°ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤  
**å®Ÿç”¨æ€§**: upload_file() ã¨ upload_directory()ã€download_for_days() ã¨ download_for_month() ã‚’1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§æä¾›

### ãƒ¡ã‚½ãƒƒãƒ‰ã®éšå±¤è¨­è¨ˆ
```python
def upload_directory(self, ...):
    for file in files:
        uri = self.upload_file(file)  # å˜ä¸€å‡¦ç†ã®å†åˆ©ç”¨

def download_for_days(self, days=5):
    months = self.get_required_months(days)  # æœˆè¨ˆç®—ã®å†åˆ©ç”¨
    for month in months:
        self.download_month_data(month)      # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®å†åˆ©ç”¨
```

**å˜ä¸€è²¬ä»»ã®åŸå‰‡**: å„ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ˜ç¢ºãªå½¹å‰²ã‚’æŒã¤  
**ã‚³ãƒ¼ãƒ‰ã®å†åˆ©ç”¨**: è¤‡é›‘ãªå‡¦ç†ã‚’å˜ç´”ãªå‡¦ç†ã®çµ„ã¿åˆã‚ã›ã§å®Ÿç¾  
**ä¿å®ˆæ€§**: 1ç®‡æ‰€ä¿®æ­£ã™ã‚Œã°å…¨ä½“ã«åæ˜ 

## ğŸ”¥ å¼•æ•°ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å®Œå…¨ç†è§£
### defã®åŸºæœ¬ãƒ«ãƒ¼ãƒ«
```python
class MyClass:
    def __init__(self, base_dir="data/raw"):
        #          ^^^^  ^^^^^^^^^^^^^^^^^
        #          self  ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä»˜ãå¼•æ•°
```

**ã‚¯ãƒ©ã‚¹å†…ãƒ¡ã‚½ãƒƒãƒ‰**: å¿…ãšæœ€åˆã¯ `self`  
**é–¢æ•°ï¼ˆã‚¯ãƒ©ã‚¹å¤–ï¼‰**: `self` ä¸è¦  
**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**: `=` ã§æŒ‡å®š  
**å¿…é ˆå¼•æ•°**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãªã—

### é–¢æ•° vs ãƒ¡ã‚½ãƒƒãƒ‰ã®é•ã„
- **é–¢æ•°**: ã‚¯ãƒ©ã‚¹å¤–ã€selfãªã—ã€ç‹¬ç«‹ã—ã¦å‹•ä½œ
- **ãƒ¡ã‚½ãƒƒãƒ‰**: ã‚¯ãƒ©ã‚¹å†…ã€selfã‚ã‚Šã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ä¾å­˜

## ğŸ”¥ argparseã®å®Œå…¨ç†è§£
### argparseã®4æ®µéšãƒ•ãƒ­ãƒ¼
1. **argparseã§ãƒ‘ãƒ¼ã‚µãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ**
2. **ãƒ‘ãƒ¼ã‚µãƒ¼ã®add_argument()ã§å¼•æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­å®š**
3. **ãƒ‘ãƒ¼ã‚µãƒ¼ã®parse_args()ã§namespaceã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ**
4. **å¿…è¦ã«å¿œã˜ã¦namespaceã§æ¡ä»¶åˆ†å²**

### ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆé–¢ä¿‚
```python
parser = ArgumentParser()    # ãƒ‘ãƒ¼ã‚µãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
args = parser.parse_args()   # ãƒ‘ãƒ¼ã‚µãƒ¼ãŒNamespaceã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¦è¿”ã™
```

**ArgumentParser**: å·¥å ´ï¼ˆãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ï¼‰  
**Namespace**: å·¥å ´ã§ä½œã‚‰ã‚Œã‚‹è£½å“

### argparseå¿…è¦æ€§ã®æ¡ä»¶
- **ãƒ¡ã‚½ãƒƒãƒ‰1ã¤**: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»importä¸¡å¯¾å¿œã§ã‚‚argparseä¸è¦
- **ãƒ¡ã‚½ãƒƒãƒ‰è¤‡æ•°**: ã‚³ãƒãƒ³ãƒ‰å¯¾å¿œã•ã›ã‚‹ãªã‚‰argparseå¿…è¦ã€ã‚³ãƒãƒ³ãƒ‰å¯¾å¿œãªã—ãªã‚‰ä¸è¦

## ğŸ”¥ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ vs å±æ€§ã®ç†è§£
### æ¦‚å¿µã®é•ã„
- **ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**: å…¨ä½“ã®å…¥ã‚Œç‰©ãƒ»ç®±ï¼ˆ`args = Namespace(...)`ï¼‰
- **å±æ€§**: ãã®ç®±ã®ä¸­ã«å…¥ã£ã¦ã„ã‚‹å€‹åˆ¥ã®é …ç›®ï¼ˆ`args.month`, `args.date`ï¼‰

### Namespaceã®æ§‹é€ 
```
â”Œâ”€ Namespaceã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ â”€â”
â”‚  month: '202505'       â”‚
â”‚  date: None            â”‚
â”‚  days: 5               â”‚
â”‚  base_dir: 'data/raw'  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”¥ Pathã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿç”¨ç†è§£
### ãƒ‘ã‚¹æ“ä½œã®é€²åŒ–
```python
# å¾“æ¥ã®æ–¹æ³•
import os
path = base_dir + "/" + yyyymm
os.makedirs(path, exist_ok=True)

# Pathã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
from pathlib import Path
month_dir = self.base_dir / yyyymm  # ç›´æ„Ÿçš„ãªçµåˆ
month_dir.mkdir(parents=True, exist_ok=True)  # ãƒ¡ã‚½ãƒƒãƒ‰ã§æ“ä½œ
```

### ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ
```python
# ã‚³ãƒ¼ãƒ‰ã§ã¯å¸¸ã« / ã‚’ä½¿ç”¨
path = Path("data") / "raw" / "202505"

# Windows: data\raw\202505
# Linux:   data/raw/202505
```

## ğŸ”¥ ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®ç†è§£
### logging_config.pyã®å½¹å‰²
- **æ–°ã—ã„ã‚¯ãƒ©ã‚¹ä½œæˆ**: ã—ã¦ã„ãªã„
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»éšå±¤æŒ‡å®š**: è¨­å®šç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- **åˆæœŸåŒ–**: `setup_logging()` ã§è¨­å®šé©ç”¨

### éšå±¤ç¶™æ‰¿ã®ä»•çµ„ã¿
```
'energy_env' (è¦ª) 
â”œâ”€â”€ 'energy_env.data_processing' (å­)
â”‚   â””â”€â”€ 'energy_env.data_processing.data_downloader' (å­«)
```

**logging_config.py**: ãƒ­ã‚¬ãƒ¼ã®è¨­å®šã‚’è¡Œã†  
**å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**: è¨­å®šæ¸ˆã¿ãƒ­ã‚¬ãƒ¼ã‚’å–å¾—ãƒ»ä½¿ç”¨ã™ã‚‹

## ğŸ”¥ 2ã¤ã®å®Ÿè¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç†è§£
### `if __name__ == "__main__":` ã®å½¹å‰²
```python
# ç›´æ¥å®Ÿè¡Œæ™‚
if __name__ == "__main__":  # True
    main()  # argparseãŒå‹•ã

# importæ™‚
if __name__ == "__main__":  # False  
    main()  # å®Ÿè¡Œã•ã‚Œãªã„ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰
```

### è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
- **ç›´æ¥å®Ÿè¡Œ**: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦å‹•ä½œ
- **import**: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦ä»–ã‹ã‚‰åˆ©ç”¨å¯èƒ½
- **1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«**: 2ã¤ã®ç”¨é€”ã‚’å…¼ä»»

## ğŸ”¥ HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç†è§£
### requestsãƒ©ã‚¤ãƒ–ãƒ©ãƒª
```python
response = requests.get(url)  # HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
response.raise_for_status()   # ã‚¨ãƒ©ãƒ¼ãªã‚‰ä¾‹å¤–ç™ºç”Ÿ
```

**requests**: å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ãªã„ï¼‰  
**raise_for_status()**: ã‚¨ãƒ©ãƒ¼ã‚’è¦‹é€ƒã•ãªã„ã‚ˆã†ã«ã™ã‚‹æ©Ÿèƒ½

## ğŸ”¥ **NEW** ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆã®ç†è§£
### è²¬ä»»åˆ†é›¢ã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
```python
def get_months_from_date(self, date_str):
    # YYYYMMDDå½¢å¼ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    date = datetime.strptime(date_str, '%Y%m%d')
    # æœªæ¥æ—¥ä»˜ãƒã‚§ãƒƒã‚¯
    if date.date() > datetime.today().date():
        raise ValueError(f"æœªæ¥ã®æ—¥ä»˜ã¯æŒ‡å®šã§ãã¾ã›ã‚“")

def download_for_month(self, yyyymm):
    # YYYYMMå½¢å¼ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    month_date = datetime.strptime(yyyymm, '%Y%m')
    # æœªæ¥æœˆãƒã‚§ãƒƒã‚¯
    if month_date > datetime.today().replace(day=1):
        raise ValueError(f"æœªæ¥ã®æœˆã¯æŒ‡å®šã§ãã¾ã›ã‚“")
```

**å„å…¥ã‚Šå£ã§è²¬ä»»ã‚’æŒã¤**: ãƒ¡ã‚½ãƒƒãƒ‰ã”ã¨ã«é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯  
**æ—©æœŸã‚¨ãƒ©ãƒ¼æ¤œå‡º**: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰ã«ä¸æ­£å…¥åŠ›ã‚’æ¤œå‡º  
**UXæ”¹å–„**: 404ã‚¨ãƒ©ãƒ¼ã‚ˆã‚Šåˆ†ã‹ã‚Šã‚„ã™ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

## ğŸ”¥ **NEW** æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ãƒ†ã‚¹ãƒˆè¨­è¨ˆã®ç†è§£
### æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¿¡é ¼
```python
# âŒ ä¸è¦ãªãƒ†ã‚¹ãƒˆ
def test_datetime_works():
    result = datetime.strptime("20250101", '%Y%m%d')
    assert result.year == 2025  # æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ†ã‚¹ãƒˆ

# âœ… å¿…è¦ãªãƒ†ã‚¹ãƒˆ
def test_our_date_validation():
    downloader = PowerDataDownloader()
    with pytest.raises(ValueError):
        downloader.get_months_from_date("invalid")  # æˆ‘ã€…ã®ã‚³ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆ
```

**ãƒ†ã‚¹ãƒˆåŸå‰‡**: è‡ªåˆ†ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ãƒ†ã‚¹ãƒˆä¸è¦  
**è²¬ä»»ç¯„å›²**: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ vs æ—¥ä»˜å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯  
**åŠ¹ç‡æ€§**: æœ¬è³ªçš„ãªãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè£…

## ğŸ”¥ **NEW** Pythonæ–‡æ³•ã®æ·±ã„ç†è§£
### ä¸‰é …æ¼”ç®—å­ï¼ˆæ¡ä»¶å¼ï¼‰
```python
# Pythonç‹¬è‡ªã®è‡ªç„¶è¨€èªé¢¨
status = "âœ“ æˆåŠŸ" if success else "âœ— å¤±æ•—"

# ä»–è¨€èªã®ä¸€èˆ¬çš„å½¢å¼
status = success ? "âœ“ æˆåŠŸ" : "âœ— å¤±æ•—"  # JavaScript, Java, Cç­‰
```

**Pythonã®ç‰¹å¾´**: èª­ã¿ã‚„ã™ã•é‡è¦–ã®èªé †  
**è‹±èªã«è¿‘ã„**: ã€ŒæˆåŠŸã€ã‚‚ã—successãªã‚‰ã€ãã†ã§ãªã‘ã‚Œã°å¤±æ•—ã€

### len()é–¢æ•°ã®å‹åˆ¥å‹•ä½œ
```python
len("hello")         # â†’ 5ï¼ˆæ–‡å­—æ•°ï¼‰
len([1, 2, 3])       # â†’ 3ï¼ˆè¦ç´ æ•°ï¼‰
len({"a": 1})        # â†’ 1ï¼ˆã‚­ãƒ¼æ•°ï¼‰
```

**ã‚¨ã‚¯ã‚»ãƒ«ã¨ã®é•ã„**: Pythonã¯ã€Œå«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®å€‹æ•°ã€æ¦‚å¿µ

### sorted()ã®å®Ÿç”¨æ€§
```python
months = {"202506", "202505"}  # setï¼ˆé †åºä¸å®šï¼‰
sorted(months)  # â†’ ['202505', '202506']ï¼ˆæ™‚ç³»åˆ—é †ï¼‰
```

**setã®é †åºå•é¡Œ**: å®Ÿè¡Œæ¯ã«è¡¨ç¤ºé †åºãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§  
**sorted()ã®ä¾¡å€¤**: å®‰å®šã—ãŸé †åºã€ãƒ‡ãƒãƒƒã‚°æ™‚ã®è¦–èªæ€§å‘ä¸Š

## ğŸ”¥ **NEW** è¾æ›¸ã¨ãƒªã‚¹ãƒˆã®æ·±ã„ç†è§£
### è¾æ›¸ã‚¢ã‚¯ã‚»ã‚¹ã®æ­£ç¢ºãªè¨˜æ³•
```python
# âœ… æ­£ã—ã„: è§’æ‹¬å¼§
results['success']   # è¾æ›¸ã‚¢ã‚¯ã‚»ã‚¹

# âŒ é–“é•ã„: æ³¢æ‹¬å¼§  
results{'success'}   # ã‚¨ãƒ©ãƒ¼
```

### è¾æ›¸ã®å€¤ã®ã¿å–å¾—
```python
download_results = {'success': ['202505'], 'failed': []}
download_results['success']  # â†’ ['202505'] ï¼ˆãƒªã‚¹ãƒˆã®ã¿ã€ã‚­ãƒ¼ã¯å«ã¾ã‚Œãªã„ï¼‰
```

### append()ã«ã‚ˆã‚‹è¾æ›¸å†…ãƒªã‚¹ãƒˆæ“ä½œ
```python
results = {'success': [], 'failed': []}
results['success'].append('202505')
# çµæœ: {'success': ['202505'], 'failed': []}
```

## ğŸ”¥ **NEW** ãƒ«ãƒ¼ãƒ—åˆ¶å¾¡ã®å®Œå…¨ç†è§£
### continue vs return ã®é•ã„
```python
# continue: ãƒ«ãƒ¼ãƒ—ã®ä»Šå›ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€ãƒ«ãƒ¼ãƒ—ã¯ç¶™ç¶š
for item in items:
    if condition:
        continue  # æ¬¡ã®itemã¸
    process(item)

# return: é–¢æ•°ã‚’çµ‚äº†ã€å‘¼ã³å‡ºã—å…ƒã«æˆ»ã‚‹  
def function():
    for item in items:
        if condition:
            return  # é–¢æ•°çµ‚äº†
        process(item)
```

**continue**: ã€Œä»Šå›ã¯ãƒ‘ã‚¹ã€æ¬¡ã§ç¶šè¡Œã€  
**return**: ã€Œé–¢æ•°çµ‚äº†ã€å‘¼ã³å‡ºã—å…ƒã«æˆ»ã‚‹ã€

## ğŸ”¥ **NEW** ETLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã®ç†è§£
### Extract-Transform-Load ã®æµã‚Œ
```python
# Extract: ãƒ‡ãƒ¼ã‚¿å–å¾—
download_results = self.downloader.download_for_month(month)

# Transform: ãƒ‡ãƒ¼ã‚¿å¤‰æ›ï¼ˆä»Šå›ã¯æœ€å°é™ï¼‰
successful_months = download_results['success']

# Load: ãƒ‡ãƒ¼ã‚¿ä¿å­˜
upload_results = self._upload_downloaded_data(successful_months)
```

### ã‚¨ãƒ©ãƒ¼è€æ€§ã®ã‚ã‚‹è¨­è¨ˆ
```python
if not download_results['success']:
    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—æ™‚ã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒƒãƒ—
    return {'overall_status': 'failed', 'message': '...'}

# æˆåŠŸæ™‚ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
upload_results = self._upload_downloaded_data(download_results['success'])
```

### ãƒ‡ãƒ¼ã‚¿ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†
```python
# æ—¥ä»˜ä»˜ããƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
f"archives/{month}/{today_str}"  # archives/202505/2025-06-12/

# è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
if (file_date < cutoff_date and file_date.day != last_day_of_month):
    blob.delete()  # 2é€±é–“ã‚ˆã‚Šå¤ãã€æœˆæœ«ã§ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
```

## ğŸ”¥ **NEW** Google Cloud Storage API ã®ç†è§£
### list_blobs() ã«ã‚ˆã‚‹ä¸€è¦§å–å¾—
```python
blobs = list(self.uploader.client.list_blobs(
    self.uploader.bucket, 
    prefix=archive_prefix
))
```

### ãƒ‘ã‚¹æ§‹é€ ã®è§£æ
```python
# "archives/202505/2025-06-01/202505.zip"
path_parts = blob.name.split('/')
date_str = path_parts[2]  # "2025-06-01"
```

## ğŸ”¥ **NEW** æ—¥ä»˜ãƒ»æ™‚åˆ»å‡¦ç†ã®å®Ÿç”¨æŠ€è¡“
### datetime.replace() ã«ã‚ˆã‚‹æ—¥ä»˜æ“ä½œ
```python
execution_date = datetime.today()     # 2025-06-12
first_day = execution_date.replace(day=1)  # 2025-06-01ï¼ˆæœˆåˆä½œæˆï¼‰
```

### calendar.monthrange() ã«ã‚ˆã‚‹æœˆæœ«å–å¾—
```python
calendar.monthrange(2025, 6)  # (5, 30)
#                            â†‘  â†‘
#                        åˆæ—¥æ›œæ—¥ æœˆã®æ—¥æ•°ï¼ˆ=æœ«æ—¥ï¼‰
```

### strftime() ã«ã‚ˆã‚‹æ–‡å­—åˆ—å¤‰æ›
```python
date.strftime('%Y%m')     # "202506" 
date.strftime('%Y-%m-%d') # "2025-06-12"
```

## ğŸ”¥ **NEW** ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¨ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã®ç†è§£
### ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã® exception = ã€Œæƒ³å®šå¤–ã®çŠ¶æ³ã¸ã®å¯¾å¿œã‚·ã‚¹ãƒ†ãƒ ã€
```python
try:
    # é€šå¸¸ã®æµã‚Œã‚’è©¦ã™
    response = requests.get(url)
    response.raise_for_status()  # ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°exceptionã‚’ç™ºç”Ÿã•ã›ã‚‹
except Exception as e:  # e = exceptionï¼ˆerrorã§ã¯ãªã„ï¼‰
    # ã€Œé€šå¸¸ã˜ã‚ƒãªã„çŠ¶æ³ã€ãŒèµ·ããŸã‚‰ç‰¹åˆ¥å¯¾å¿œ
    print("ä½•ã‹æƒ³å®šå¤–ã®ã“ã¨ãŒèµ·ãã¾ã—ãŸ")
```

**exception**: æƒ³å®šå¤–ã®å•é¡Œãƒ»å¤±æ•—ãƒ»ç•°å¸¸äº‹è±¡ï¼ˆæ—¥æœ¬èªã®ã€Œä¾‹å¤–çš„ã«è¨±å¯ã€ã¨ã¯çœŸé€†ï¼‰

### Pythonã®å®Ÿè¡Œãƒ•ãƒ­ãƒ¼
```
1. Python(.py) â†’ 2. ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰(.pyc) â†’ 3. æ©Ÿæ¢°èªï¼ˆCPUå®Ÿè¡Œï¼‰
```

**ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰**: ä¸­é–“è¨€èªï¼ˆå…±é€šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰  
**å„OSç”¨Pythonã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼**: ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰â†’æ©Ÿæ¢°èªå¤‰æ›ã‚’æ‹…å½“

### ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ä»•çµ„ã¿
```
æ—¥æœ¬èªï¼ˆPythonã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰â†’ è‹±èªï¼ˆãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ï¼‰â†’ å„å›½èªï¼ˆå„OSæ©Ÿæ¢°èªï¼‰
```

## ğŸ”¥ **NEW** ç’°å¢ƒç®¡ç†ã¨Gitã®é–¢ä¿‚
### Gitã§ç®¡ç†ã•ã‚Œã‚‹ã‚‚ã® vs ã•ã‚Œãªã„ã‚‚ã®
```python
# Gitç®¡ç†ã•ã‚Œã‚‹
- ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ (.py ãƒ•ã‚¡ã‚¤ãƒ«)
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« (.gitignoreç­‰)

# Gitç®¡ç†ã•ã‚Œãªã„
- ç’°å¢ƒå¤‰æ•° (GOOGLE_APPLICATION_CREDENTIALSç­‰)
- OSè¨­å®š
- __pycache__/ (è‡ªå‹•ç”Ÿæˆã‚­ãƒ£ãƒƒã‚·ãƒ¥)
```

### ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
```cmd
# ä¸€æ™‚çš„ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã¿ï¼‰
set GOOGLE_APPLICATION_CREDENTIALS=ãƒ‘ã‚¹

# æ°¸ç¶šçš„ï¼ˆWindows ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒå¤‰æ•°ï¼‰
Windows + R â†’ sysdm.cpl â†’ è©³ç´°è¨­å®š â†’ ç’°å¢ƒå¤‰æ•°
```

## ğŸ”¥ **NEW** VS Codeçµ±åˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ä»•çµ„ã¿
### VS Codeçµ±åˆã‚¿ãƒ¼ãƒŸãƒŠãƒ« vs å¤–éƒ¨cmd
```bash
# VS Codeçµ±åˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼ˆæ¨å¥¨ï¼‰
python -m tests.test_main_etl  # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œã€srcèªè­˜ã•ã‚Œã‚‹

# å¤–éƒ¨cmdãƒ»ã€Œå°‚ç”¨ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œã€
python tests/test_main_etl.py  # ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã€srcãŒè¦‹ãˆãªã„
```

### `-m` ãƒ•ãƒ©ã‚°ã®é‡è¦æ€§
```python
# python -m ã§å®Ÿè¡Œ
# â†’ ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒsys.pathã«è¿½åŠ ã•ã‚Œã‚‹
# â†’ from src.module import ... ãŒèªè­˜ã•ã‚Œã‚‹

# python file.py ã§å®Ÿè¡Œ  
# â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒåŸºæº–
# â†’ src ãŒè¦‹ãˆãšimport ã‚¨ãƒ©ãƒ¼
```

### VS Codeçµ±åˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®è‡ªå‹•æ©Ÿèƒ½
- **ä»®æƒ³ç’°å¢ƒã®è‡ªå‹•ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–**
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šã®è‡ªå‹•èªè­˜**
- **Python ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã®è‡ªå‹•è¨­å®š**

## ğŸ”¥ **NEW** å®Ÿéš›ã®ETLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡ŒçµŒé¨“
### å®Ÿãƒ‡ãƒ¼ã‚¿ã§ã®å‹•ä½œç¢ºèª
```python
# å®Ÿéš›ã«æ±é›»ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
# â†’ 31å€‹ã®CSVãƒ•ã‚¡ã‚¤ãƒ« + ZIPãƒ•ã‚¡ã‚¤ãƒ«
# â†’ Google Cloud Storageã¸è‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
# â†’ æ—¥ä»˜ä»˜ãã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ä½œæˆãƒ»å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
```

### ãƒ†ã‚¹ãƒˆè¨­è¨ˆã®å®Ÿè·µ
```python
# åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ: è¨­å®šç¢ºèªã®ã¿
# æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ: å®Ÿéš›ã®ETLå‡¦ç†ç¢ºèª
# ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: æœªæ¥æ—¥ä»˜ãƒ»ç„¡åŠ¹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®æ¤œè¨¼
# çµæœæ¤œè¨¼: è¾æ›¸æ§‹é€ ã¨ã‚­ãƒ¼ã®å­˜åœ¨ç¢ºèª
```

## ğŸ”¥ **NEW** ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã¨CSVåŠ å·¥ã®ç†è§£
### ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã®åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³
```python
# os.path ã®åŸºæœ¬ãƒ¡ã‚½ãƒƒãƒ‰
os.path.basename("/path/to/file.csv")  # â†’ "file.csv" ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã®ã¿ï¼‰
os.path.dirname("/path/to/file.csv")   # â†’ "/path/to" ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã¿ï¼‰
os.path.join(dir_name, filename)       # â†’ ãƒ•ãƒ«ãƒ‘ã‚¹ç”Ÿæˆ
```

### CSVãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã®å®Ÿè·µ
```python
# ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’èª­ã¿è¾¼ã¿
with open(csv_path, 'r', encoding='shift-jis') as f:
    content = f.read()

# è¡Œã”ã¨ã«åˆ†å‰²
lines = content.split('\n')

# å„è¡Œã‚’å€‹åˆ¥å‡¦ç†
for i, line in enumerate(lines):
    # i = ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç•ªå·ï¼ˆä½•è¡Œç›®ã‹ï¼‰
    # line = ãã®è¡Œã®å†…å®¹ï¼ˆæ–‡å­—åˆ—ï¼‰
```

### enumerate() ã®å®Œå…¨ç†è§£
```python
data = ["apple", "banana", "cherry"]

for i, item in enumerate(data):
    print(f"{i}: {item}")
# å‡ºåŠ›:
# 0: apple
# 1: banana  
# 2: cherry
```

**enumerate() = ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç•ªå·ã‚’è‡ªå‹•ã§æŒ¯ã£ã¦ãã‚Œã‚‹æ©Ÿèƒ½**

## ğŸ”¥ **NEW** æ–‡å­—åˆ—å‡¦ç†ã®å®Ÿç”¨æŠ€è¡“
### strip() ã«ã‚ˆã‚‹å‰å¾Œç©ºç™½å‰Šé™¤
```python
text = "  hello world  \n"
clean_text = text.strip()  # â†’ "hello world"
```

**é™¤å»å¯¾è±¡**: ç©ºç™½ã€ã‚¿ãƒ–ã€æ”¹è¡Œæ–‡å­—ï¼ˆ\r\nï¼‰ç­‰

### æ–‡å­—åˆ—ã®åˆ†å‰²ã¨çµåˆ
```python
# åˆ†å‰²
parts = "2025/4/1".split('/')  # â†’ ["2025", "4", "1"]

# ã‚¼ãƒ­åŸ‹ã‚
month = "4".zfill(2)  # â†’ "04" ï¼ˆ2æ¡ã«ãªã‚‹ã‚ˆã†0åŸ‹ã‚ï¼‰

# çµåˆ
date = f"{year}-{month}-{day}"  # â†’ "2025-04-01"
```

## ğŸ”¥ **NEW** BigQueryãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã®ç†è§£
### ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆã®åŸå‰‡
```json
{
  "name": "hour",
  "type": "STRING",    # ã‚«ãƒ†ã‚´ãƒªå¤‰æ•°ã¨ã—ã¦æ‰±ã†ãŸã‚
  "mode": "REQUIRED"
}
```

**æ•°å€¤ vs æ–‡å­—åˆ—ã®é¸æŠ**:
- **æ•°å€¤**: æ©Ÿæ¢°å­¦ç¿’ã§å¤§å°é–¢ä¿‚ã‚’å­¦ç¿’ã—ã¦ã—ã¾ã†
- **æ–‡å­—åˆ—**: ã‚«ãƒ†ã‚´ãƒªã¨ã—ã¦ç‹¬ç«‹ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’

### BigQueryã®MODEè¨­å®š
```python
REQUIRED:  # NULLä¸å¯ã€å¿…ãšå€¤ãŒå¿…è¦
NULLABLE:  # NULLå¯ã€ç©ºã§ã‚‚OKï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
REPEATED:  # é…åˆ—ãƒ‡ãƒ¼ã‚¿
```

### ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã¨ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
```python
# ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ï¼ˆæ—¥ä»˜ãƒ™ãƒ¼ã‚¹ï¼‰ = å®Œå…¨åˆ†é›¢
# â†’ å¯¾è±¡å¤–ã®æ—¥ä»˜ã¯100%ã‚¹ã‚­ãƒƒãƒ—

# ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼ˆæ™‚åˆ»ãƒ™ãƒ¼ã‚¹ï¼‰ = åŠ¹ç‡çš„ä¸¦ã³æ›¿ãˆ  
# â†’ é–¢é€£ãƒ‡ãƒ¼ã‚¿ã‚’è¿‘ãã«é…ç½®ã€éƒ¨åˆ†çš„ã«ã‚¹ã‚­ãƒƒãƒ—
```

## ğŸ”¥ **NEW** ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆæ€æƒ³ã®ç¢ºç«‹
### ã€Œè¨ˆç®—å¯èƒ½ãªã‚‚ã®ã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒãŸãªã„ã€åŸå‰‡
```sql
-- âŒ äº‹å‰è¨ˆç®—ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
usage_rate: 74.2

-- âœ… å‹•çš„è¨ˆç®—ï¼ˆLooker Studioç­‰ã§ï¼‰
ä½¿ç”¨ç‡ = SUM(actual_power) / SUM(supply_capacity) * 100
```

**ãƒ¡ãƒªãƒƒãƒˆ**: ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆé˜²æ­¢ã€è¨ˆç®—å¼å¤‰æ›´ã¸ã®æŸ”è»Ÿå¯¾å¿œ

### è‡ªå‹•åŒ– vs æ‰‹å‹•ã®åˆ¤æ–­åŸºæº–
```python
# è‡ªå‹•åŒ–ã™ã¹ã: é »ç¹ã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†
- ãƒ‡ãƒ¼ã‚¿è»¢é€ã€ETLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

# æ‰‹å‹•ã§ååˆ†: ç¨€ã«ã—ã‹å¤‰æ›´ã•ã‚Œãªã„è¨­å®š  
- ã‚¹ã‚­ãƒ¼ãƒä½œæˆã€ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ
```

**YAGNIåŸå‰‡**: You Aren't Gonna Need Itï¼ˆæœ¬å½“ã«å¿…è¦ã«ãªã£ã¦ã‹ã‚‰å®Ÿè£…ï¼‰

## ğŸ”¥ **NEW** BigQuery EXTERNAL TABLE ã®ç†è§£
### EXTERNAL TABLE ã¨ã¯
```sql
-- é€šå¸¸ã®ãƒ†ãƒ¼ãƒ–ãƒ«: ãƒ‡ãƒ¼ã‚¿ãŒBigQueryå†…ã«ç‰©ç†ä¿å­˜
CREATE TABLE my_table (name STRING, age INT64);
INSERT INTO my_table VALUES ('Alice', 25);

-- EXTERNAL TABLE: GCSä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»®æƒ³çš„ã«å‚ç…§
CREATE EXTERNAL TABLE my_external_table (
  name STRING, age INT64
) OPTIONS (
  format = 'CSV',
  uris = ['gs://my-bucket/data.csv']
);
```

### ãªãœEXTERNAL TABLEã‚’ä½¿ã†ã®ã‹
```sql
-- âŒ å­˜åœ¨ã—ãªã„ç†æƒ³çš„ãªæ§‹æ–‡
INSERT INTO table FROM GCS_FILES('gs://bucket/*.csv')

-- âœ… å®Ÿéš›ã®å›é¿ç­–
CREATE EXTERNAL TABLE â†’ SELECT with å‹å¤‰æ› â†’ INSERT â†’ DROP
```

**BigQueryã®åˆ¶ç´„ã‚’å›é¿ã™ã‚‹æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³**

### EXTERNAL TABLEã®å‡¦ç†ãƒ•ãƒ­ãƒ¼
```sql
-- Step 1: GCSä¸Šã®CSVã‚’ä»®æƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦å®šç¾©
CREATE EXTERNAL TABLE temp_csv (...) OPTIONS (uris = ['gs://...'])

-- Step 2: å‹å¤‰æ›ã—ãªãŒã‚‰INSERT
INSERT INTO real_table 
SELECT PARSE_DATE('%Y-%m-%d', date), CAST(power AS FLOAT64)
FROM temp_csv

-- Step 3: ä»®æƒ³ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤ï¼ˆGCSãƒ•ã‚¡ã‚¤ãƒ«ã¯æ®‹ã‚‹ï¼‰
DROP EXTERNAL TABLE temp_csv
```

## ğŸ”¥ **NEW** CMDåˆ¶å¾¡æ§‹æ–‡ã®å®Ÿè·µç†è§£
### CMDã®é †æ¬¡å®Ÿè¡Œç‰¹æ€§
```cmd
python script1.py  # ã“ã®å‡¦ç†ãŒ100%å®Œäº†ã™ã‚‹ã¾ã§å¾…ã¤
python script2.py  # ä¸ŠãŒå®Œäº†ã—ã¦ã‹ã‚‰å®Ÿè¡Œé–‹å§‹
```

**ä¸¦åˆ—å®Ÿè¡Œã—ãªã„**: startã‚³ãƒãƒ³ãƒ‰ä»˜ã‘ãªã„é™ã‚Šé †æ¬¡å‡¦ç†

### foræ–‡ã«ã‚ˆã‚‹ä¸€æ‹¬å‡¦ç†
```cmd
# CMD foræ–‡ã§é€£ç¶šå®Ÿè¡Œ
for %m in (202301 202302 202303) do python -m src.pipelines.main_etl --month %m

# å„å€¤ãŒé †ç•ªã«%mã«ä»£å…¥ã•ã‚Œã¦å®Ÿè¡Œ
```

### WHERE TRUE ã®æ„å‘³
```sql
DELETE FROM table WHERE TRUE;  -- æ˜ç¤ºçš„ãªå…¨å‰Šé™¤æ„å›³
DELETE FROM table